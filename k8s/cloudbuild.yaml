steps:
- name: 'docker'
  args: ['build', '-t', 'gcr.io/$PROJECT_ID/asterisk-16-ari:$SHORT_SHA', '.']
- name: 'gcr.io/cloud-builders/docker'
  args: ['tag', 'gcr.io/$PROJECT_ID/asterisk-16-ari:$SHORT_SHA', 'gcr.io/$PROJECT_ID/asterisk-16-ari:latest']
- name: 'gcr.io/cloud-builders/docker'
  args: ['tag', 'gcr.io/$PROJECT_ID/asterisk-16-ari:$SHORT_SHA', 'gcr.io/$PROJECT_ID/asterisk-16-ari:$BRANCH_NAME']
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/asterisk-16-ari:$SHORT_SHA']
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/asterisk-16-ari:latest']
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/asterisk-16-ari:$BRANCH_NAME']
# deploy container image to GKE
- name: "gcr.io/cloud-builders/gke-deploy"
  args:
  - run
  - --filename=/k8s/deployment.yaml
  - --location=$_K8S_ZONE
  - --cluster=$_K8S_CLUSTER
images:
- 'gcr.io/$PROJECT_ID/asterisk-16-ari:$BRANCH_NAME'
